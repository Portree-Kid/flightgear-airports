osx_image: xcode8.3
sudo: required
dist: xenial
language: node_js
workspaces:
  use:
  - binaries
cache:
  directories:
  - node_modules
  - "$HOME/.electron"
  - "$HOME/.cache"
addons:
before_install:
install:
- source ~/.bashrc
- npm install -g xvfb-maybe
- npm install
node_js:
- 10.15.3
jobs:
  include:
    - stage: Build binaries
      os: windows
      script:
      - npm run build
      - mkdir windows-binaries
      - mv -v build/flightgear-airports* windows-binaries/
      - ls -l windows-binaries
      workspaces:
        create:
          name: windows-binaries
          paths: windows-binaries
    - os: linux
      script:
      - npm run build
      - mkdir linux-binaries
      - mv -v build/flightgear-airports* linux-binaries/
      - ls -l linux-binaries
      workspaces:
        create:
          name: linux-binaries
          paths: linux-binaries
    - os: osx
      script:
      - npm run build
      - mkdir osx-binaries
      - mv -v build/flightgear-airports* osx-binaries/
      - ls -l osx-binaries
      workspaces:
        create:
          name: osx-binaries
          paths: osx-binaries
    - stage: Deploy
      install:
      - pwd
      - find -name *osx-binaries*
      - tar -xzf ${CASHER_DIR}/osx-binaries-fetch.tgz
      - find -name flightgear-airports*
      - cp ./Users/travis/build/Portree-Kid/flightgear-airports/osx-binaries/*.dmg build/
      - cp ./C:/Users/travis/build/Portree-Kid/flightgear-airports/windows-binaries/*.exe build/
      - cp ./linux-binaries/*.AppImage build/
      - ls -l "build/"
      script: skip
      workspaces:
        use:
        - windows-binaries
        - linux-binaries
        - osx-binaries
      deploy:
        skip_cleanup: true
        overwrite: true
        draft: true
        name: '0.0.33'
        provider: releases
        api_key:
          secure: YOZloW096748HIBKbntBznFujflK6276yQsYbkhbQmcAs7nZoQVAAtX9QRHTbPQ1T5XYE/OK2c430LseEsF74c9Hl4kVcnExgOTPuqlMaiQqyrBJbl0lCjGuxmIkE9MhRQsvjDEVgjiz70+fXj9wg4lB9XlPDD0dAE5lTqMEgbVvdihx7ypznH4EHVVc4xebSDyNSXC6scemHgVPfVM1mC0jgjPPkj380WMINrzOqxBNNLYYQTkl8E8A2K0j3piuhWMXnF9txFfhwhb89VH/GZB1OcnAmaPedsvJAGZyGpuVOEb9JT6D3u+1TdsIk5bHCq6UYOCwxy1Lfo3jKzJ7QH1Woe4U3uoBdhFuq3x99tCoq5r4TQm689oIEKsmcap7ppjFoHFH11E8wvssKt0T/FWUDm5+pNwDxBiB5yOETeto8vKzrxFoqL15pWgU8Hma0lpXYGV+wv9xq2bC9uBKjGLhRTAFoVJmTb9mksv2prMiJgHgSY6xDFBVRjaj7RgbDLuMVIg3bfMJvOo1mSBUtmby2ZOcv2xg8ds9aQUGFTjVPc53OPHLfdsDY/jI/kWUAvDCDoieyAe4clKzkBsxwwVekFGvAxxicTQ6Iu6j+LpGM3w6DHuv6mkD/XC1ha2w/ZnER8JCkpHZhqWlyj0QDF3Vw8boJNdbB+w/CW30124=
        file_glob: true    
        file: build/*
        on:
          branches: '0.0.33'
          repo: Portree-Kid/flightgear-airports
